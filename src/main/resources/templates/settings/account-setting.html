<!DOCTYPE html>

<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{layouts/base :: head(~{::title}, _)}">
    <title>북카이브 - 설정</title>
</head>

<body th:replace="~{layouts/base :: _body('setting', ~{::div}, ~{::script}, false)}">
<div class="container-xxl flex-grow-1 container-p-y">
    <ol class="breadcrumb">
        <li class="breadcrumb-item">
            <a class="btn-link" th:href="@{/}">홈</a>
        </li>
        <li class="breadcrumb-item">
            <a>설정</a>
        </li>
        <li class="breadcrumb-item active">계정</li>
    </ol>

    <ul th:replace="~{settings/setting-nav :: nav('account')}"></ul>

    <div class="row">
        <!-- 회원정보 수정 -->
        <div class="col-lg-6">
            <div class="card mb-4">
                <h5 class="card-header">회원정보 수정</h5>
                <div class="card-body">
                    <div class="d-flex align-items-start gap-3">
                        <img class="img-thumbnail square rounded w-15 w-lg-20 min-w-px-100"
                             th:src="@{/assets/img/book01.jpg}" id="uploadedAvatar"/>
                        <div class="button-wrapper">
                            <p class="fw-medium mt-1">홍길동</p>
                            <small class="d-block text-muted mb-3">example@boochive.com</small>
                            <div class="btn-group">
                                <button class="btn btn-md btn-outline-primary dropdown-toggle"
                                        data-bs-toggle="dropdown" aria-expanded="false">
                                    프로필 변경
                                </button>
                                <ul class="dropdown-menu">
                                    <li>
                                        <label for="upload" class="dropdown-item">
                                            <span>내 파일 선택</span>
                                            <input type="file" id="upload" class="profile-img-input"
                                                   accept="image/*"
                                                   hidden/>
                                        </label>
                                    </li>
                                    <li>
                                        <a class="dropdown-item profile-img-random" href="javascript:void(0);">
                                            랜덤 프로필</a>
                                    </li>
                                    <li><hr class="dropdown-divider"></li>
                                    <li>
                                        <a class="dropdown-item text-danger profile-img-reset" href="javascript:void(0);">
                                            초기화
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <hr class="my-0"/>
                <div class="card-body">
                    <form>
                        <div class="row mb-3">
                            <label class="col-sm-2 col-form-label text-primary" for="username">이름 (필수)</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" id="username" name="username"
                                       placeholder="홍길동">
                            </div>
                        </div>
                        <div class="row mb-3">
                            <label class="col-sm-2 col-form-label" for="birthYear">생년월일</label>
                            <div class="col-sm-10">
                                <div class="input-group gap-2">
                                    <div class="col">
                                        <select class="select2 form-select" id="birthYear" name="birthYear">
                                            <option>년도</option>
                                        </select>
                                    </div>
                                    <div class="col">
                                        <select class="select2 form-select" id="birthMonth" name="birthMonth">
                                            <option>월</option>
                                        </select>
                                    </div>
                                    <div class="col">
                                        <select class="select2 form-select" id="birthDay" name="birthDay">
                                            <option>일</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <label class="col-sm-2 col-form-label">성별</label>
                            <div class="col-sm-10 d-flex align-items-center">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="gender" id="genderMale"
                                           value="M" checked>
                                    <label class="form-check-label" for="genderMale">남자</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" name="gender" id="genderFemale"
                                           value="F">
                                    <label class="form-check-label" for="genderFemale">여자</label>
                                </div>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <label class="col-sm-2 col-form-label" for="phoneNumber">휴대폰 번호</label>
                            <div class="col-sm-10">
                                <div class="input-group">
                                    <div class="input-group">
                                        <input type="text" class="form-control phone-num" id="phoneNumber"
                                               name="phoneNumber" placeholder="010-1234-5678">
                                        <button type="button" class="btn btn-outline-primary collapse-btn"
                                                id="sendBtn" data-target="#collapseWrap">인증번호 전송
                                        </button>
                                    </div>
                                </div>
                                <div class="input-group form-collapse hide mt-2" id="collapseWrap">
                                    <div class="input-group input-group-merge w-auto">
                                        <input type="text" class="form-control" id="phoneAuthNumber"
                                               name="phoneAuthNumber" placeholder="인증번호 입력">
                                        <span class="input-group-text" id="authTimer"
                                              style="border-bottom-right-radius: 0; border-top-right-radius: 0;">
                                    <span class="tm-min">3</span> :
                                    <span class="tm-sec">00</span>
                                </span>
                                    </div>
                                    <button type="button" class="btn btn-secondary" id="completeBtn">확인</button>
                                </div>
                            </div>
                        </div>
                        <!--                                <div class="row mb-3">-->
                        <!--                                    <label class="col-sm-2 col-form-label" for="description">소개</label>-->
                        <!--                                    <div class="col-sm-10">-->
                        <!--                                        <textarea class="form-control" id="description" name="description"></textarea>-->
                        <!--                                    </div>-->
                        <!--                                </div>-->
                        <!--                                <div class="row mb-3">-->
                        <!--                                    <label class="col-sm-2 col-form-label">프로필 공개 설정</label>-->
                        <!--                                    <div class="col-sm-10" style="padding-top: 0.4375rem;">-->
                        <!--                                        <div class="form-check form-switch">-->
                        <!--                                            <input class="form-check-input" type="checkbox" id="profileVisibility"-->
                        <!--                                                   name="profileVisibility">-->
                        <!--                                            <label class="form-check-label" for="profileVisibility">공개 설정</label>-->
                        <!--                                        </div>-->
                        <!--                                        <div class="form-text">공개로 설정하시면 ...</div>-->
                        <!--                                    </div>-->
                        <!--                                </div>-->

                        <div class="pt-2">
                            <button type="submit" class="btn btn-primary me-2">변경사항 저장</button>
                            <button type="reset" class="btn btn-outline-secondary">취소</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- 비밀번호 변경 -->
        <div class="col-lg-6">
            <div class="card mb-4">
                <h5 class="card-header">비밀번호 변경</h5>
                <div class="card-body">
                    <form>
                        <div class="row mb-3">
                            <label class="col-sm-2 col-form-label">이메일</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control-plaintext" value="example@boochive.com"
                                       readonly>
                            </div>
                        </div>
                        <div class="row mb-3 form-password-toggle">
                            <label class="col-sm-2 col-form-label" for="password">현재 비밀번호</label>
                            <div class="col-sm-10">
                                <div class="input-group input-group-merge">
                                    <input type="password" class="form-control" id="password" name="password"
                                           placeholder="현재 비밀번호"/>
                                    <span class="input-group-text cursor-pointer">
                                <i class="bx bx-hide"></i>
                            </span>
                                </div>
                            </div>
                        </div>
                        <div class="row mb-3 form-password-toggle">
                            <label class="col-sm-2 col-form-label" for="password">새 비밀번호</label>
                            <div class="col-sm-10">
                                <div class="input-group input-group-merge">
                                    <input type="password" class="form-control" id="newPassword"
                                           name="newPassword" placeholder="새 비밀번호"/>
                                    <span class="input-group-text cursor-pointer"><i
                                            class="bx bx-hide"></i></span>
                                </div>
                                <div class="input-group input-group-merge mt-2">
                                    <input type="password" class="form-control" id="newPasswordConfirm"
                                           name="newPasswordConfirm" placeholder="새 비밀번호 확인"/>
                                    <span class="input-group-text cursor-pointer">
                                <i class="bx bx-hide"></i>
                            </span>
                                </div>
                            </div>
                        </div>

                        <div class="pt-2">
                            <button type="submit" class="btn btn-primary me-2">비밀번호 변경</button>
                            <button type="reset" class="btn btn-outline-secondary">취소</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- 회원 탈퇴 -->
    <div class="card">
                <h5 class="card-header">회원 탈퇴</h5>
                <div class="card-body">
                    <div class="mb-3 col-12 mb-0">
                        <div class="alert alert-warning">
                            <h6 class="alert-heading mb-1">정말 계정을 삭제하시겠습니까?</h6>
                            <p>계정을 삭제할 경우 재사용 및 복구가 불가능합니다. 신중하게 선택하시기 바랍니다.</p>
                        </div>
                    </div>
                    <form id="formAccountDeactivation" onsubmit="return false">
                        <div class="form-check mb-3">
                            <input type="checkbox" class="form-check-input" name="withdrawalConfirm"
                                   id="withdrawalConfirm"/>
                            <label class="form-check-label" for="withdrawalConfirm">계정 삭제를 동의합니다.</label>
                        </div>
                        <button type="submit" class="btn btn-danger deactivate-account">회원 탈퇴</button>
                        <!-- TODO: 탈퇴 확인 모달 -->
                    </form>
                </div>
            </div>
</div>

<script th:src="@{/assets/js/profile-image.js}"></script>
<script>
    // TODO: (임시) 백엔드 붙일 때 뒷단 프로세스가 성공하면 해당 처리
    for (const el of document.getElementsByClassName('collapse-btn')) {
        el.addEventListener('click', function () {
            el.disabled = true;
            document.querySelector(el.dataset.target).classList.remove('hide');
        })
    }

    /**
     * 인증번호 유효시간 타이머
     */
    const sendBtn = document.getElementById('sendBtn');
    const completeBtn = document.getElementById('completeBtn');

    const timerEl = document.getElementById('authTimer')
    const timer = new Timer(timerEl);
    timer.init(180);

    // TODO: 이건 사용자 UI 유효시간이고, DB에도 따로 저장해서 유효시간 검증 해야 함
    document.getElementById('sendBtn').addEventListener('click', function () {
        timer.init(180); // 시간 초기화
        timer.start(() => {
            sendBtn.disabled = false;
            completeBtn.disabled = true;
        });
        // TODO: 유효시간 만료되면 다음 프로세스가 어떻게 되는지 찾아보고 기능 수정 (인증번호 전송 버튼 다시 열어주기?)
    })
</script>
</body>
</html>
